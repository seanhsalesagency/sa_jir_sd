<script>
async function loadForms() {
  const res = await fetch('/data/jira_forms.json');
  const forms = await res.json();
  const formSelector = document.getElementById('form-selector');

  forms.forEach(form => {
    const option = document.createElement('option');
    option.value = form.issueType;
    option.textContent = form.issueType;
    formSelector.appendChild(option);
  });

  formSelector.addEventListener('change', () => renderForm(forms));
}

function renderForm(forms) {
  const selected = document.getElementById('form-selector').value;
  const formFields = forms.find(f => f.issueType === selected).fields;
  
  const formDiv = document.getElementById('form-container');
  formDiv.innerHTML = '';

  formFields.forEach(field => {
    const label = document.createElement('label');
    label.textContent = field.name + (field.required ? '*' : '');
    formDiv.appendChild(label);

    const input = field.schema.type === 'string' ? 
      document.createElement('input') : document.createElement('textarea');
    input.id = field.id;
    input.required = field.required;
    formDiv.appendChild(input);
  });

  const submitBtn = document.createElement('button');
  submitBtn.textContent = 'Submit';
  formDiv.appendChild(submitBtn);

  submitBtn.onclick = submitForm;
}

async function submitForm() {
  const formType = document.getElementById('form-selector').value;
  const inputs = document.querySelectorAll('#form-container input, #form-container textarea');
  const fields = {};

  inputs.forEach(input => fields[input.id] = input.value);

  const res = await fetch('YOUR_LAMBDA_URL', {
    method: 'POST',
    body: JSON.stringify({formType, ...fields})
  });
  
  const json = await res.json();
  if (json.ticket) {
    location.href = `/src/forms/thank-you.html?ticket=${json.ticket}`;
  }
}

document.addEventListener('DOMContentLoaded', loadForms);
</script>

<select id="form-selector"><option>Select Form</option></select>
<div id="form-container"></div>


